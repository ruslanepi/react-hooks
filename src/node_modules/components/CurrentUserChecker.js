import React from 'react'
import useFetch from 'hooks/useFetch'
import { CurrentUserContext } from 'contexts/currentUser'
import useLocalStorage from 'hooks/useLocalStorage'



const CurrentUserChecker = ({children}) => {
    const [{response}, doFetch] = useFetch('/user')
    const [, dispatch] = React.useContext(CurrentUserContext)
    const [token] = useLocalStorage('token')


    React.useEffect(() => {
        if(!token) {
            dispatch({type: 'SET_UNAUTHORIZED'})
            return
        }
        doFetch()
        dispatch({type: 'LOADING'})
    }, [token, dispatch , doFetch])




    React.useEffect(() => {
        if(!response) {
            return
        }
        dispatch({type: 'SET_AUTHORIZED', payload:response.user })
    }, [response])

    return  children
}


export default CurrentUserChecker